<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APO - –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</title>
    <style>
        body {
            margin: 0;
            background: #0f0b1f;
            color: white;
            font-family: Arial, sans-serif;
        }

        .gradient-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(157, 107, 204, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(107, 63, 160, 0.15) 0%, transparent 50%);
            z-index: -2;
        }

        .app-container {
            width: 100%;
            height: 100vh;
            display: flex;
        }

        .auth-screen {
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .auth-card {
            background: rgba(25, 18, 48, 0.95);
            border: 1px solid rgba(157, 107, 204, 0.3);
            border-radius: 24px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(45, 27, 105, 0.4);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo {
            font-size: 48px;
            font-weight: 900;
            background: linear-gradient(135deg, #9d6bcc 0%, #6b3fa0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .app-name {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #ffffff;
        }

        .app-subtitle {
            font-size: 14px;
            color: #b39fdb;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #ffffff;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-size: 13px;
            color: #b39fdb;
        }

        .form-input {
            width: 100%;
            padding: 14px;
            background: rgba(45, 27, 105, 0.4);
            border: 1px solid rgba(157, 107, 204, 0.3);
            border-radius: 10px;
            color: #ffffff;
            font-size: 14px;
        }

        .form-input:focus {
            outline: none;
            border-color: #9d6bcc;
            background: rgba(45, 27, 105, 0.6);
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #9d6bcc, #6b3fa0);
            color: white;
        }

        .btn-secondary {
            background: rgba(45, 27, 105, 0.4);
            color: #b39fdb;
            border: 1px solid rgba(157, 107, 204, 0.3);
        }

        .main-app {
            display: none;
            width: 100%;
            height: 100vh;
        }

        .app-sidebar {
            width: 250px;
            background: rgba(25, 18, 48, 0.95);
            border-right: 1px solid rgba(157, 107, 204, 0.2);
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 10px;
            background: rgba(45, 27, 105, 0.4);
            margin-bottom: 20px;
        }

        .user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, #9d6bcc, #6b3fa0);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 700;
            color: white;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 3px;
            color: #ffffff;
        }

        .user-status {
            font-size: 11px;
            color: #8a6bbe;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-indicator {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #4ade80;
        }

        .user-ip {
            font-size: 10px;
            color: #8a6bbe;
            background: rgba(107, 63, 160, 0.2);
            padding: 3px 6px;
            border-radius: 6px;
            margin-top: 4px;
            cursor: pointer;
        }

        .nav-menu {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .nav-item {
            padding: 12px 14px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            color: #b39fdb;
            font-weight: 500;
        }

        .nav-item:hover {
            background: rgba(157, 107, 204, 0.1);
            color: #ffffff;
        }

        .nav-item.active {
            background: rgba(157, 107, 204, 0.2);
            color: #ffffff;
            border-left: 3px solid #9d6bcc;
        }

        .nav-icon {
            font-size: 18px;
            width: 20px;
        }

        .nav-badge {
            margin-left: auto;
            background: linear-gradient(135deg, #ff6b9d, #e83e8c);
            color: white;
            padding: 3px 8px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
        }

        .search-box {
            margin-top: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px;
            background: rgba(45, 27, 105, 0.4);
            border: 1px solid rgba(157, 107, 204, 0.3);
            border-radius: 10px;
            color: #ffffff;
            font-size: 13px;
        }

        .app-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(19, 15, 38, 0.9);
        }

        .content-header {
            padding: 18px 25px;
            border-bottom: 1px solid rgba(157, 107, 204, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 22px;
            font-weight: 700;
            color: #ffffff;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: rgba(157, 107, 204, 0.2);
            color: #b39fdb;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .content-area {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
        }

        .page-content {
            display: none;
            height: 100%;
        }

        .page-content.active {
            display: block;
        }

        .chats-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .chat-item {
            background: rgba(45, 27, 105, 0.4);
            border: 1px solid rgba(157, 107, 204, 0.2);
            border-radius: 14px;
            padding: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .chat-item:hover {
            border-color: #9d6bcc;
        }

        .chat-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #9d6bcc, #6b3fa0);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: 700;
            color: white;
        }

        .chat-info {
            flex: 1;
        }

        .chat-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 3px;
            color: #ffffff;
        }

        .last-message {
            color: #b39fdb;
            font-size: 13px;
        }

        .search-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            background: rgba(45, 27, 105, 0.4);
            padding: 6px;
            border-radius: 10px;
        }

        .search-tab {
            flex: 1;
            padding: 8px;
            border: none;
            background: transparent;
            color: #b39fdb;
            cursor: pointer;
            border-radius: 8px;
        }

        .search-tab.active {
            background: rgba(157, 107, 204, 0.3);
            color: #ffffff;
        }

        .search-form {
            margin-bottom: 25px;
        }

        .search-form .form-input {
            margin-bottom: 12px;
        }

        .search-results {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .user-card {
            background: rgba(45, 27, 105, 0.4);
            border: 1px solid rgba(157, 107, 204, 0.2);
            border-radius: 14px;
            padding: 18px;
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .user-card:hover {
            border-color: #9d6bcc;
        }

        .user-avatar-md {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #9d6bcc, #6b3fa0);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: 700;
            color: white;
        }

        .user-details {
            flex: 1;
        }

        .user-name-md {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 3px;
            color: #ffffff;
        }

        .user-ip-display {
            font-size: 12px;
            color: #8a6bbe;
            margin-bottom: 6px;
        }

        .user-status-md {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: #4ade80;
        }

        .user-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn-sm {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
        }

        .action-btn-primary {
            background: linear-gradient(135deg, #9d6bcc, #6b3fa0);
            color: white;
        }

        .action-btn-secondary {
            background: rgba(45, 27, 105, 0.6);
            color: #b39fdb;
            border: 1px solid rgba(157, 107, 204, 0.3);
        }

        .calls-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .call-item {
            background: rgba(45, 27, 105, 0.4);
            border: 1px solid rgba(157, 107, 204, 0.2);
            border-radius: 14px;
            padding: 18px;
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .call-type {
            font-size: 22px;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(157, 107, 204, 0.2);
        }

        .call-info {
            flex: 1;
        }

        .call-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 3px;
            color: #ffffff;
        }

        .call-details {
            color: #b39fdb;
            font-size: 13px;
        }

        .requests-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .settings-card {
            background: rgba(45, 27, 105, 0.4);
            border: 1px solid rgba(157, 107, 204, 0.2);
            border-radius: 14px;
            padding: 22px;
        }

        .settings-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 18px;
            color: #ffffff;
        }

        .chat-window {
            display: flex;
            flex-direction: column;
            height: 100%;
            background: rgba(25, 18, 48, 0.9);
            border-radius: 14px;
            overflow: hidden;
        }

        .chat-header-bar {
            padding: 18px;
            background: rgba(45, 27, 105, 0.6);
            border-bottom: 1px solid rgba(157, 107, 204, 0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-partner {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chat-messages {
            flex: 1;
            padding: 22px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message {
            max-width: 70%;
            padding: 12px;
            border-radius: 16px;
            position: relative;
        }

        .message.outgoing {
            align-self: flex-end;
            background: linear-gradient(135deg, #9d6bcc, #6b3fa0);
            color: white;
        }

        .message.incoming {
            align-self: flex-start;
            background: rgba(45, 27, 105, 0.6);
            color: #ffffff;
            border: 1px solid rgba(157, 107, 204, 0.2);
        }

        .message-text {
            margin-bottom: 4px;
        }

        .message-time {
            font-size: 11px;
            opacity: 0.7;
            text-align: right;
        }

        .message-input-area {
            padding: 18px;
            background: rgba(45, 27, 105, 0.6);
            border-top: 1px solid rgba(157, 107, 204, 0.2);
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .message-input {
            flex: 1;
            padding: 14px;
            background: rgba(25, 18, 48, 0.8);
            border: 1px solid rgba(157, 107, 204, 0.3);
            border-radius: 10px;
            color: #ffffff;
            font-size: 14px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(25, 18, 48, 0.95);
            border: 1px solid rgba(157, 107, 204, 0.3);
            border-radius: 10px;
            padding: 12px 18px;
            color: white;
            display: none;
            z-index: 1000;
        }

        ::-webkit-scrollbar {
            width: 5px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(45, 27, 105, 0.2);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #9d6bcc, #6b3fa0);
            border-radius: 3px;
        }

        .invite-link-container {
            background: rgba(45, 27, 105, 0.4);
            border: 1px solid rgba(157, 107, 204, 0.3);
            border-radius: 14px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .invite-link {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .invite-link input {
            flex: 1;
            padding: 10px;
            background: rgba(25, 18, 48, 0.8);
            border: 1px solid rgba(157, 107, 204, 0.3);
            border-radius: 8px;
            color: white;
        }

        .copy-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #9d6bcc, #6b3fa0);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="gradient-bg"></div>
    <div class="notification" id="notification"></div>
    
    <div class="app-container">
        <div class="auth-screen" id="authScreen">
            <div class="auth-card">
                <div class="auth-header">
                    <div class="logo">APO</div>
                    <div class="app-name">APO –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</div>
                    <div class="app-subtitle">–û–±—â–∞–π—Ç–µ—Å—å, –∑–≤–æ–Ω–∏—Ç–µ, –Ω–∞—Ö–æ–¥–∏—Ç–µ –¥—Ä—É–∑–µ–π</div>
                </div>

                <div class="auth-form active" id="registerForm">
                    <h2 class="form-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
                    <div class="form-group">
                        <label class="form-label">–í–∞—à–µ –∏–º—è</label>
                        <input type="text" class="form-input" id="inputName" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" class="form-input" id="inputUsername" placeholder="ivan2024">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" class="form-input" id="inputPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button class="btn btn-primary" id="btnRegister">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                    <button class="btn btn-secondary" id="btnSwitchToLogin">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏</button>
                    <div id="registerError" style="color: #ff6b9d; margin-top: 10px; text-align: center;"></div>
                </div>

                <div class="auth-form" id="loginForm">
                    <h2 class="form-title">–í—Ö–æ–¥</h2>
                    <div class="form-group">
                        <label class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" class="form-input" id="loginUsername" placeholder="ivan2024">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" class="form-input" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button class="btn btn-primary" id="btnLogin">–í–æ–π—Ç–∏</button>
                    <button class="btn btn-secondary" id="btnSwitchToRegister">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç</button>
                    <div id="loginError" style="color: #ff6b9d; margin-top: 10px; text-align: center;"></div>
                </div>
            </div>
        </div>

        <div class="main-app" id="mainApp">
            <div class="app-sidebar">
                <div class="sidebar-header">
                    <div class="user-profile">
                        <div class="user-avatar" id="sidebarAvatar">–ò</div>
                        <div class="user-info">
                            <div class="user-name" id="sidebarName">–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤</div>
                            <div class="user-status">
                                <span class="status-indicator"></span>
                                <span id="sidebarStatus">–í —Å–µ—Ç–∏</span>
                            </div>
                            <div class="user-ip" id="sidebarIP" title="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è">IP: 192.168.1.1</div>
                        </div>
                    </div>
                </div>

                <div class="nav-menu">
                    <div class="nav-item active" data-page="chats">
                        <span class="nav-icon">üí¨</span>
                        <span>–ß–∞—Ç—ã</span>
                        <span class="nav-badge" id="badgeChats">0</span>
                    </div>
                    <div class="nav-item" data-page="search">
                        <span class="nav-icon">üîç</span>
                        <span>–ù–∞–π—Ç–∏ –¥—Ä—É–∑–µ–π</span>
                    </div>
                    <div class="nav-item" data-page="friends">
                        <span class="nav-icon">üë•</span>
                        <span>–î—Ä—É–∑—å—è</span>
                        <span class="nav-badge" id="badgeFriends">0</span>
                    </div>
                    <div class="nav-item" data-page="addFriend">
                        <span class="nav-icon">‚ûï</span>
                        <span>–î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞</span>
                    </div>
                    <div class="nav-item" data-page="settings">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                    </div>
                </div>
            </div>

            <div class="app-content">
                <div class="content-header">
                    <div class="page-title" id="pageTitle">–ú–æ–∏ —á–∞—Ç—ã</div>
                    <div class="header-actions">
                        <button class="action-btn" title="–í—ã—Ö–æ–¥" id="btnLogout">üö™</button>
                    </div>
                </div>

                <div class="content-area" id="contentArea">
                    <div class="page-content active" id="pageChats">
                        <div class="chats-list" id="chatsList"></div>
                    </div>

                    <div class="page-content" id="pageSearch">
                        <div class="search-form">
                            <h3 style="margin-bottom: 15px;">–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏</h3>
                            <input type="text" class="form-input" id="searchInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –¥—Ä—É–≥–∞...">
                            <button class="action-btn-sm action-btn-primary" id="btnSearch">üîç –ù–∞–π—Ç–∏</button>
                        </div>
                        <div class="search-results" id="searchResults"></div>
                    </div>

                    <div class="page-content" id="pageFriends">
                        <div class="search-results" id="friendsList"></div>
                    </div>

                    <div class="page-content" id="pageAddFriend">
                        <div class="invite-link-container">
                            <h3>1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–∞—à—É —Å—Å—ã–ª–∫—É-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</h3>
                            <p style="color: #b39fdb; font-size: 14px; margin-bottom: 10px;">–û—Ç–ø—Ä–∞–≤—å—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É –¥—Ä—É–≥—É. –ö–æ–≥–¥–∞ –æ–Ω –æ—Ç–∫—Ä–æ–µ—Ç –µ—ë, –≤—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–µ—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏</p>
                            <div class="invite-link">
                                <input type="text" id="inviteLink" readonly>
                                <button class="copy-btn" id="btnCopyInvite">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                            </div>
                        </div>

                        <div class="invite-link-container">
                            <h3>2. –ò–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É –¥—Ä—É–≥–∞</h3>
                            <p style="color: #b39fdb; font-size: 14px; margin-bottom: 10px;">–ï—Å–ª–∏ –¥—Ä—É–≥ –æ—Ç–ø—Ä–∞–≤–∏–ª –≤–∞–º —Å–≤–æ—é —Å—Å—ã–ª–∫—É, –≤—Å—Ç–∞–≤—å—Ç–µ –µ—ë —Å—é–¥–∞:</p>
                            <div class="invite-link">
                                <input type="text" id="friendLink" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –¥—Ä—É–≥–∞...">
                                <button class="copy-btn action-btn-primary" id="btnOpenFriendLink">–û—Ç–∫—Ä—ã—Ç—å</button>
                            </div>
                        </div>

                        <div class="invite-link-container">
                            <h3>3. –ò–ª–∏ –ø–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏</h3>
                            <p style="color: #b39fdb; font-size: 14px; margin-bottom: 10px;">–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–æ–∏—Å–∫–∞:</p>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" class="form-input" id="searchNameInput" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                                <button class="action-btn-sm action-btn-primary" id="btnSearchByName">üîç –ù–∞–π—Ç–∏</button>
                            </div>
                            <div id="searchByNameResults" style="margin-top: 15px;"></div>
                        </div>
                    </div>

                    <div class="page-content" id="pageSettings">
                        <div class="settings-grid">
                            <div class="settings-card">
                                <div class="settings-title">–ü—Ä–æ—Ñ–∏–ª—å</div>
                                <div class="form-group">
                                    <label class="form-label">–ò–º—è</label>
                                    <input type="text" class="form-input" id="settingName">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                                    <input type="text" class="form-input" id="settingStatus" value="–í —Å–µ—Ç–∏">
                                </div>
                                <button class="action-btn-sm action-btn-primary" id="btnSaveProfile">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            </div>
                        </div>
                    </div>

                    <div class="page-content" id="pageChat">
                        <div class="chat-window">
                            <div class="chat-header-bar">
                                <div class="chat-partner">
                                    <button class="action-btn" id="btnBackToChats">‚Üê</button>
                                    <div class="user-avatar-md" id="chatPartnerAvatar">–ê</div>
                                    <div>
                                        <div class="user-name-md" id="chatPartnerName">–ê–ª–µ–∫—Å–µ–π</div>
                                        <div class="user-status-md">
                                            <span class="status-indicator"></span>
                                            <span id="chatPartnerStatus">–í —Å–µ—Ç–∏</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="chat-messages" id="chatMessages"></div>
                            
                            <div class="message-input-area">
                                <input type="text" class="message-input" id="messageInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
                                <button class="action-btn-sm action-btn-primary" id="btnSendMessage">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class APOMessenger {
            constructor() {
                this.currentUser = null;
                this.currentPage = 'chats';
                this.currentChat = null;
                this.friends = [];
                this.messages = [];
                
                // –ö–ª—é—á–∏ –¥–ª—è localStorage
                this.USERS_KEY = 'apo_users';
                this.FRIENDSHIPS_KEY = 'apo_friendships';
                this.MESSAGES_KEY = 'apo_messages';
                
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.checkUrlForInvite();
                
                const savedUser = localStorage.getItem('apo_current_user');
                if (savedUser) {
                    this.currentUser = JSON.parse(savedUser);
                    this.loadUserData();
                    this.showMainApp();
                }
            }
            
            checkUrlForInvite() {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
                const urlParams = new URLSearchParams(window.location.search);
                const inviteId = urlParams.get('invite');
                
                if (inviteId && inviteId !== '') {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º invite ID –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–≤—Ö–æ–¥–∞
                    sessionStorage.setItem('pending_invite', inviteId);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    this.showNotification('–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è! –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –≤—ã —Å–º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞.');
                }
            }
            
            loadUserData() {
                if (!this.currentUser) return;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥—Ä—É–∑–µ–π
                this.friends = this.getFriendshipsForUser(this.currentUser.id);
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
                this.messages = this.getMessagesForUser(this.currentUser.id);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
                this.checkPendingInvite();
            }
            
            getFriendshipsForUser(userId) {
                const friendships = JSON.parse(localStorage.getItem(this.FRIENDSHIPS_KEY) || '[]');
                return friendships.filter(f => 
                    f.user1 === userId || f.user2 === userId
                ).map(f => ({
                    id: f.id,
                    friendId: f.user1 === userId ? f.user2 : f.user1
                }));
            }
            
            getMessagesForUser(userId) {
                const allMessages = JSON.parse(localStorage.getItem(this.MESSAGES_KEY) || '[]');
                return allMessages.filter(m => 
                    m.senderId === userId || m.receiverId === userId
                );
            }
            
            getAllUsers() {
                return JSON.parse(localStorage.getItem(this.USERS_KEY) || '[]');
            }
            
            saveUser(user) {
                const users = this.getAllUsers();
                const existingIndex = users.findIndex(u => u.id === user.id);
                
                if (existingIndex !== -1) {
                    users[existingIndex] = user;
                } else {
                    users.push(user);
                }
                
                localStorage.setItem(this.USERS_KEY, JSON.stringify(users));
            }
            
            register() {
                const name = document.getElementById('inputName').value.trim();
                const username = document.getElementById('inputUsername').value.trim();
                const password = document.getElementById('inputPassword').value;
                const errorEl = document.getElementById('registerError');
                
                if (!name || !username || !password) {
                    errorEl.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è';
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–Ω—è—Ç –ª–∏ username
                const users = this.getAllUsers();
                if (users.some(u => u.username === username)) {
                    errorEl.textContent = '–≠—Ç–æ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∂–µ –∑–∞–Ω—è—Ç–æ';
                    return;
                }
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
                const userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                
                this.currentUser = {
                    id: userId,
                    name: name,
                    username: username,
                    password: password,
                    avatar: name.charAt(0).toUpperCase(),
                    status: '–í —Å–µ—Ç–∏',
                    ip: `192.168.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`,
                    createdAt: new Date().toISOString()
                };
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                this.saveUser(this.currentUser);
                localStorage.setItem('apo_current_user', JSON.stringify(this.currentUser));
                
                this.loadUserData();
                this.showMainApp();
                this.showNotification(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${name}!`);
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
                this.generateInviteLink();
            }
            
            login() {
                const username = document.getElementById('loginUsername').value.trim();
                const password = document.getElementById('loginPassword').value;
                const errorEl = document.getElementById('loginError');
                
                if (!username || !password) {
                    errorEl.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è';
                    return;
                }
                
                const users = this.getAllUsers();
                const user = users.find(u => u.username === username && u.password === password);
                
                if (!user) {
                    errorEl.textContent = '–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
                    return;
                }
                
                user.status = '–í —Å–µ—Ç–∏';
                this.currentUser = user;
                localStorage.setItem('apo_current_user', JSON.stringify(this.currentUser));
                this.saveUser(user);
                
                this.loadUserData();
                this.showMainApp();
                this.showNotification(`–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º, ${user.name}!`);
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
                this.generateInviteLink();
            }
            
            generateInviteLink() {
                if (!this.currentUser) return;
                
                // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É —Å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const baseUrl = window.location.origin + window.location.pathname;
                const inviteUrl = `${baseUrl}?invite=${this.currentUser.id}`;
                
                document.getElementById('inviteLink').value = inviteUrl;
            }
            
            checkPendingInvite() {
                const pendingInvite = sessionStorage.getItem('pending_invite');
                if (pendingInvite && this.currentUser) {
                    // –î–æ–±–∞–≤–ª—è–µ–º –¥—Ä—É–≥–∞ –ø–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—é
                    this.addFriendByInvite(pendingInvite);
                    sessionStorage.removeItem('pending_invite');
                    
                    // –û—á–∏—â–∞–µ–º URL
                    window.history.replaceState({}, document.title, window.location.pathname);
                }
            }
            
            addFriendByInvite(friendId) {
                if (friendId === this.currentUser.id) {
                    this.showNotification('–ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–∏—Ç—å —Å–∞–º–æ–≥–æ —Å–µ–±—è!');
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥—Ä—É–∑—å—è –ª–∏ —É–∂–µ
                const existingFriendship = this.friends.find(f => f.friendId === friendId);
                if (existingFriendship) {
                    this.showNotification('–≠—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –≤ –≤–∞—à–∏—Ö –¥—Ä—É–∑—å—è—Ö');
                    return;
                }
                
                // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const users = this.getAllUsers();
                const friend = users.find(u => u.id === friendId);
                
                if (!friend) {
                    this.showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    return;
                }
                
                // –°–æ–∑–¥–∞–µ–º –¥—Ä—É–∂–±—É
                const friendshipId = 'friendship_' + Date.now();
                const friendships = JSON.parse(localStorage.getItem(this.FRIENDSHIPS_KEY) || '[]');
                
                friendships.push({
                    id: friendshipId,
                    user1: this.currentUser.id,
                    user2: friendId,
                    createdAt: new Date().toISOString()
                });
                
                localStorage.setItem(this.FRIENDSHIPS_KEY, JSON.stringify(friendships));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π
                this.friends = this.getFriendshipsForUser(this.currentUser.id);
                
                // –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                this.sendWelcomeMessage(friendId);
                
                this.showNotification(`–í—ã –¥–æ–±–∞–≤–∏–ª–∏ ${friend.name} –≤ –¥—Ä—É–∑—å—è!`);
                this.renderFriends();
                this.renderChats();
            }
            
            sendWelcomeMessage(friendId) {
                const messageId = 'msg_' + Date.now();
                const messages = JSON.parse(localStorage.getItem(this.MESSAGES_KEY) || '[]');
                
                messages.push({
                    id: messageId,
                    senderId: this.currentUser.id,
                    receiverId: friendId,
                    text: 'üëã –ü—Ä–∏–≤–µ—Ç! –ú—ã —Ç–µ–ø–µ—Ä—å –¥—Ä—É–∑—å—è!',
                    timestamp: Date.now(),
                    read: false
                });
                
                localStorage.setItem(this.MESSAGES_KEY, JSON.stringify(messages));
                this.messages = this.getMessagesForUser(this.currentUser.id);
            }
            
            searchUserByName(name) {
                const users = this.getAllUsers();
                const searchTerm = name.toLowerCase().trim();
                
                return users.filter(user => 
                    user.id !== this.currentUser.id &&
                    (user.name.toLowerCase().includes(searchTerm) || 
                     user.username.toLowerCase().includes(searchTerm))
                );
            }
            
            renderChats() {
                const container = document.getElementById('chatsList');
                
                if (this.friends.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #b39fdb;">
                            <div style="font-size: 48px; margin-bottom: 16px;">üí¨</div>
                            <div style="font-size: 18px; margin-bottom: 8px;">–ù–µ—Ç —á–∞—Ç–æ–≤</div>
                            <div style="font-size: 14px;">–î–æ–±–∞–≤—å—Ç–µ –¥—Ä—É–∑–µ–π —á–µ—Ä–µ–∑ —Ä–∞–∑–¥–µ–ª "–î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞"</div>
                        </div>
                    `;
                    return;
                }
                
                const users = this.getAllUsers();
                container.innerHTML = this.friends.map(friendInfo => {
                    const friend = users.find(u => u.id === friendInfo.friendId);
                    if (!friend) return '';
                    
                    const lastMessage = this.messages
                        .filter(m => 
                            (m.senderId === this.currentUser.id && m.receiverId === friend.id) ||
                            (m.senderId === friend.id && m.receiverId === this.currentUser.id)
                        )
                        .sort((a, b) => b.timestamp - a.timestamp)[0];
                    
                    return `
                        <div class="chat-item" onclick="messenger.openChat('${friend.id}')">
                            <div class="chat-avatar" style="background: ${this.getAvatarColor(friend.id)};">
                                ${friend.avatar}
                            </div>
                            <div class="chat-info">
                                <div class="chat-name">${friend.name}</div>
                                <div class="last-message">
                                    ${lastMessage ? lastMessage.text.substring(0, 50) + '...' : '–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ'}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            renderFriends() {
                const container = document.getElementById('friendsList');
                const users = this.getAllUsers();
                const friends = users.filter(u => 
                    this.friends.some(f => f.friendId === u.id)
                );
                
                if (friends.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #b39fdb;">
                            <div style="font-size: 48px; margin-bottom: 16px;">üë•</div>
                            <div style="font-size: 18px; margin-bottom: 8px;">–ù–µ—Ç –¥—Ä—É–∑–µ–π</div>
                            <div style="font-size: 14px;">–î–æ–±–∞–≤—å—Ç–µ –¥—Ä—É–∑–µ–π —á–µ—Ä–µ–∑ —Ä–∞–∑–¥–µ–ª "–î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞"</div>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = friends.map(friend => `
                    <div class="user-card">
                        <div class="user-avatar-md" style="background: ${this.getAvatarColor(friend.id)};">
                            ${friend.avatar}
                        </div>
                        <div class="user-details">
                            <div class="user-name-md">${friend.name}</div>
                            <div class="user-ip-display">IP: ${friend.ip}</div>
                            <div class="user-status-md">
                                <span class="status-indicator" style="background: ${friend.status === '–í —Å–µ—Ç–∏' ? '#4ade80' : '#8a6bbe'};"></span>
                                ${friend.status}
                            </div>
                        </div>
                        <div class="user-actions">
                            <button class="action-btn-sm action-btn-primary" onclick="messenger.openChat('${friend.id}')">
                                üí¨ –ß–∞—Ç
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            openChat(friendId) {
                const users = this.getAllUsers();
                const friend = users.find(u => u.id === friendId);
                if (!friend) return;
                
                this.currentChat = friend;
                this.showPage('chat');
                
                document.getElementById('chatPartnerAvatar').textContent = friend.avatar;
                document.getElementById('chatPartnerName').textContent = friend.name;
                document.getElementById('chatPartnerStatus').textContent = friend.status;
                
                this.renderMessages();
            }
            
            renderMessages() {
                if (!this.currentChat) return;
                
                const container = document.getElementById('chatMessages');
                const messages = this.messages
                    .filter(m => 
                        (m.senderId === this.currentUser.id && m.receiverId === this.currentChat.id) ||
                        (m.senderId === this.currentChat.id && m.receiverId === this.currentUser.id)
                    )
                    .sort((a, b) => a.timestamp - b.timestamp);
                
                if (messages.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #b39fdb;">
                            <div style="font-size: 48px; margin-bottom: 16px;">üí¨</div>
                            <div style="font-size: 18px; margin-bottom: 8px;">–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</div>
                            <div style="font-size: 14px;">–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ –ø–µ—Ä–≤—ã–º</div>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = messages.map(message => {
                    const isOutgoing = message.senderId === this.currentUser.id;
                    const time = this.formatTime(message.timestamp, true);
                    
                    return `
                        <div class="message ${isOutgoing ? 'outgoing' : 'incoming'}">
                            <div class="message-text">${message.text}</div>
                            <div class="message-time">${time}</div>
                        </div>
                    `;
                }).join('');
                
                container.scrollTop = container.scrollHeight;
            }
            
            sendMessage() {
                if (!this.currentChat) {
                    this.showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è');
                    return;
                }
                
                const input = document.getElementById('messageInput');
                const text = input.value.trim();
                
                if (!text) {
                    this.showNotification('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ');
                    return;
                }
                
                const messageId = 'msg_' + Date.now();
                const messages = JSON.parse(localStorage.getItem(this.MESSAGES_KEY) || '[]');
                
                messages.push({
                    id: messageId,
                    senderId: this.currentUser.id,
                    receiverId: this.currentChat.id,
                    text: text,
                    timestamp: Date.now(),
                    read: false
                });
                
                localStorage.setItem(this.MESSAGES_KEY, JSON.stringify(messages));
                this.messages = this.getMessagesForUser(this.currentUser.id);
                
                input.value = '';
                this.renderMessages();
                this.showNotification('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ');
            }
            
            setupEventListeners() {
                document.getElementById('btnRegister').onclick = () => this.register();
                document.getElementById('btnLogin').onclick = () => this.login();
                document.getElementById('btnSwitchToLogin').onclick = () => this.showLoginForm();
                document.getElementById('btnSwitchToRegister').onclick = () => this.showRegisterForm();
                
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.onclick = (e) => {
                        const page = e.currentTarget.dataset.page;
                        this.showPage(page);
                    };
                });
                
                document.getElementById('btnSendMessage').onclick = () => this.sendMessage();
                document.getElementById('messageInput').onkeypress = (e) => {
                    if (e.key === 'Enter') this.sendMessage();
                };
                
                document.getElementById('btnSaveProfile').onclick = () => this.saveProfile();
                document.getElementById('btnLogout').onclick = () => this.logout();
                document.getElementById('btnBackToChats').onclick = () => this.showPage('chats');
                document.getElementById('btnCopyInvite').onclick = () => this.copyInviteLink();
                document.getElementById('btnOpenFriendLink').onclick = () => this.openFriendLink();
                document.getElementById('btnSearchByName').onclick = () => this.searchByName();
                document.getElementById('btnSearch').onclick = () => this.searchGlobal();
                
                document.getElementById('sidebarIP').onclick = () => this.copyIP();
            }
            
            copyInviteLink() {
                const linkInput = document.getElementById('inviteLink');
                linkInput.select();
                navigator.clipboard.writeText(linkInput.value).then(() => {
                    this.showNotification('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞! –û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ—ë –¥—Ä—É–≥—É.');
                });
            }
            
            openFriendLink() {
                const linkInput = document.getElementById('friendLink');
                const link = linkInput.value.trim();
                
                if (!link) {
                    this.showNotification('–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –¥—Ä—É–≥–∞');
                    return;
                }
                
                try {
                    const url = new URL(link);
                    const urlParams = new URLSearchParams(url.search);
                    const inviteId = urlParams.get('invite');
                    
                    if (inviteId) {
                        this.addFriendByInvite(inviteId);
                        linkInput.value = '';
                    } else {
                        this.showNotification('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Å—ã–ª–∫–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è');
                    }
                } catch (e) {
                    this.showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å—Å—ã–ª–∫–∏');
                }
            }
            
            searchByName() {
                const nameInput = document.getElementById('searchNameInput');
                const name = nameInput.value.trim();
                
                if (!name) {
                    this.showNotification('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –¥–ª—è –ø–æ–∏—Å–∫–∞');
                    return;
                }
                
                const results = this.searchUserByName(name);
                const container = document.getElementById('searchByNameResults');
                
                if (results.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: #b39fdb;">
                            <div style="font-size: 24px; margin-bottom: 10px;">üòî</div>
                            <div>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "${name}" –Ω–µ –Ω–∞–π–¥–µ–Ω</div>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = results.map(user => {
                    const isAlreadyFriend = this.friends.some(f => f.friendId === user.id);
                    
                    return `
                        <div class="user-card">
                            <div class="user-avatar-md" style="background: ${this.getAvatarColor(user.id)};">
                                ${user.avatar}
                            </div>
                            <div class="user-details">
                                <div class="user-name-md">${user.name}</div>
                                <div style="font-size: 13px; color: #8a6bbe;">
                                    @${user.username}
                                </div>
                                <div class="user-status-md">
                                    <span class="status-indicator" style="background: ${user.status === '–í —Å–µ—Ç–∏' ? '#4ade80' : '#8a6bbe'};"></span>
                                    ${user.status}
                                </div>
                            </div>
                            <div class="user-actions">
                                ${isAlreadyFriend ? `
                                    <button class="action-btn-sm" style="background: #4ade80; color: white;" disabled>
                                        ‚úì –î—Ä—É–≥
                                    </button>
                                ` : `
                                    <button class="action-btn-sm action-btn-primary" onclick="messenger.addFriendByInvite('${user.id}')">
                                        + –î–æ–±–∞–≤–∏—Ç—å
                                    </button>
                                `}
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            searchGlobal() {
                const searchInput = document.getElementById('searchInput').value.trim();
                if (!searchInput) return;
                
                const results = this.searchUserByName(searchInput);
                const container = document.getElementById('searchResults');
                
                container.innerHTML = results.map(user => `
                    <div class="user-card">
                        <div class="user-avatar-md" style="background: ${this.getAvatarColor(user.id)};">
                            ${user.avatar}
                        </div>
                        <div class="user-details">
                            <div class="user-name-md">${user.name}</div>
                            <div style="font-size: 13px; color: #8a6bbe;">
                                @${user.username}
                            </div>
                            <div class="user-status-md">
                                <span class="status-indicator" style="background: ${user.status === '–í —Å–µ—Ç–∏' ? '#4ade80' : '#8a6bbe'};"></span>
                                ${user.status}
                            </div>
                        </div>
                        <div class="user-actions">
                            <button class="action-btn-sm action-btn-primary" onclick="messenger.openChat('${user.id}')">
                                üí¨ –ß–∞—Ç
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            showMainApp() {
                document.getElementById('authScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'flex';
                this.updateUserInfo();
                this.showPage('chats');
            }
            
            updateUserInfo() {
                if (!this.currentUser) return;
                
                document.getElementById('sidebarAvatar').textContent = this.currentUser.avatar;
                document.getElementById('sidebarName').textContent = this.currentUser.name;
                document.getElementById('sidebarStatus').textContent = this.currentUser.status;
                document.getElementById('sidebarIP').textContent = `IP: ${this.currentUser.ip}`;
                document.getElementById('settingName').value = this.currentUser.name;
                document.getElementById('settingStatus').value = this.currentUser.status;
            }
            
            showPage(pageId) {
                this.currentPage = pageId;
                
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                if (pageId !== 'chat') {
                    const navItem = document.querySelector(`[data-page="${pageId}"]`);
                    if (navItem) navItem.classList.add('active');
                }
                
                const titles = {
                    chats: '–ú–æ–∏ —á–∞—Ç—ã',
                    search: '–ü–æ–∏—Å–∫ –¥—Ä—É–∑–µ–π',
                    friends: '–ú–æ–∏ –¥—Ä—É–∑—å—è',
                    addFriend: '–î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞',
                    settings: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏',
                    chat: '–ß–∞—Ç'
                };
                document.getElementById('pageTitle').textContent = titles[pageId] || '';
                
                document.querySelectorAll('.page-content').forEach(page => {
                    page.classList.remove('active');
                });
                
                const pageElement = document.getElementById(`page${pageId.charAt(0).toUpperCase() + pageId.slice(1)}`);
                if (pageElement) {
                    pageElement.classList.add('active');
                    
                    if (pageId === 'addFriend') {
                        this.generateInviteLink();
                    } else if (pageId === 'chats') {
                        this.renderChats();
                    } else if (pageId === 'friends') {
                        this.renderFriends();
                    }
                }
            }
            
            saveProfile() {
                const name = document.getElementById('settingName').value.trim();
                const status = document.getElementById('settingStatus').value.trim();
                
                if (!name) {
                    this.showNotification('–í–≤–µ–¥–∏—Ç–µ –∏–º—è');
                    return;
                }
                
                this.currentUser.name = name;
                this.currentUser.status = status;
                this.currentUser.avatar = name.charAt(0).toUpperCase();
                
                this.saveUser(this.currentUser);
                localStorage.setItem('apo_current_user', JSON.stringify(this.currentUser));
                
                this.updateUserInfo();
                this.renderChats();
                this.showNotification('–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
            }
            
            logout() {
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
                    if (this.currentUser) {
                        this.currentUser.status = '–ù–µ –≤ —Å–µ—Ç–∏';
                        this.saveUser(this.currentUser);
                    }
                    localStorage.removeItem('apo_current_user');
                    this.currentUser = null;
                    location.reload();
                }
            }
            
            copyIP() {
                navigator.clipboard.writeText(this.currentUser.ip).then(() => {
                    this.showNotification('IP —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
                });
            }
            
            showNotification(message) {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.style.display = 'block';
                
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 3000);
            }
            
            formatTime(timestamp, showSeconds = false) {
                const date = new Date(timestamp);
                const now = new Date();
                
                if (date.toDateString() === now.toDateString()) {
                    return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                }
                
                const yesterday = new Date(now);
                yesterday.setDate(yesterday.getDate() - 1);
                if (date.toDateString() === yesterday.toDateString()) {
                    return '–í—á–µ—Ä–∞';
                }
                
                const weekAgo = new Date(now);
                weekAgo.setDate(weekAgo.getDate() - 7);
                if (date > weekAgo) {
                    const days = ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];
                    return days[date.getDay()];
                }
                
                return date.toLocaleDateString();
            }
            
            getAvatarColor(userId) {
                const colors = ['#9d6bcc', '#6b3fa0', '#8b5cf6', '#7c3aed', '#4a2d7a', '#2d1b69'];
                const index = parseInt(userId.replace(/\D/g, '')) || 0;
                return colors[index % colors.length];
            }
            
            showLoginForm() {
                document.getElementById('registerForm').classList.remove('active');
                document.getElementById('loginForm').classList.add('active');
                document.getElementById('registerError').textContent = '';
                document.getElementById('loginError').textContent = '';
            }
            
            showRegisterForm() {
                document.getElementById('loginForm').classList.remove('active');
                document.getElementById('registerForm').classList.add('active');
                document.getElementById('registerError').textContent = '';
                document.getElementById('loginError').textContent = '';
            }
        }

        let messenger;

        document.addEventListener('DOMContentLoaded', () => {
            messenger = new APOMessenger();
            window.messenger = messenger;
            
            console.log('üíú APO –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –∑–∞–ø—É—â–µ–Ω!');
            console.log('üîó –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞:');
            console.log('1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–≤–æ—é —Å—Å—ã–ª–∫—É-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ');
            console.log('2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –¥—Ä—É–≥—É (WhatsApp, Telegram, SMS)');
            console.log('3. –î—Ä—É–≥ –æ—Ç–∫—Ä–æ–µ—Ç —Å—Å—ã–ª–∫—É –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è');
            console.log('4. –í—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–µ—Ç–µ –¥—Ä—É–∑—å—è–º–∏ –∏ —Å–º–æ–∂–µ—Ç–µ –æ–±—â–∞—Ç—å—Å—è!');
        });
    </script>
</body>
</html>